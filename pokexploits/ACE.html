<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>ISSOtm's website &bull; Pok&eacute;mon ACE</title>

		<!-- Bootstrap -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
		
		<link rel="stylesheet" href="../css/common.css">

		<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
		<!--[if lt IE 9]>
			<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
			<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->
	</head>
	<body>
		<nav class="navbar navbar-inverse navbar-fixed-top">
			<div class="container">
				<div class="navbar-header">
					<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
						<span class="sr-only">Toggle navigation</span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</button>
					<a class="navbar-brand" href="https://issotm.github.io/">ISSOtm's website</a>
				</div>
				<div id="navbar" class="navbar-collapse collapse">
					<ul class="nav navbar-nav">
						<li><a href="../aboutme.html">About me</a></li>
						<li><a href="../aevilia.html">Aevilia</a></li>
						<li>8F Helper</li>
						<li><a href="http://prama-initiative.com/8F/beta/">GBZ80 to Items</a></li>
						<li class="active"><a href="../pokexploits/">Pok&eacute;sploitz</a></li>
						<li>The rest</li>
					</ul>
			</div>
		</nav>
		
		
		<div class="container">
			<h2>Arbitrary Code Execution, dayum !</h2>
			<p class="lead">
				ACE is almost putting you on the same level as the game developers ! Because you are controlling exactly what instructions the CPU is running.
				<br/>
				And if that isn't total control over the Game Boy, I don't know what is, seriously.
			</p>
			
			<hr>
			
			<h3>Click the tabs to see stuff !</h3>
			<div>

				<!-- Nav tabs -->
				<ul class="nav nav-tabs" role="tablist">
					<li role="presentation" class="active"><a href="#home" aria-controls="home" role="tab" data-toggle="tab">Home</a></li>
					<li role="presentation"><a href="#items" aria-controls="messages" role="tab" data-toggle="tab">Making the console our b**ch</a></li>
					<li role="presentation"><a href="#creating" aria-controls="creating" role="tab" data-toggle="tab">Creating setups</a></li>
					<li role="presentation"><a href="#tech" aria-controls="tech" role="tab" data-toggle="tab">Tech details</a></li>
				</ul>

				<!-- Tab panes -->
				<div class="tab-content">
					<div role="tabpanel" class="tab-pane active" id="home">
						<h4>How to perform ACE</h4>
						<p>
							As I said, there are sooo many ways of performing ACE on Pok&eacute;mon Red, Blue and Yellow. However, ACE methods are different in Yellow, yet somewhat similar ; I will thus focus on Red &amp; Blue.
						</p>
						<p>
							In Po&eacute;mon Red and Blue, there exists a cool invalid item that's named 8F. Smart people will notice that you see it, in the Silph. Co elevator floor choice.
							<br/>
							But, even though it exists as an item (since elevator floor choices are implemented as special item lists), you're never supposed to have it in your item pack !
						</p>
						<p>
							The first thing is to obtain 8F. That's not quite that complicated, actually ! What you need to do is perform the <a href="http://glitchcity.info/wiki/Celadon_looping_map_trick">Celadon Looping Map Trick</a> and walk right (and down when needed) until you have a 8F in your bag.
							<br/>
							Here is how to do this, just so that I mirror the information contained there :P
							<br/>
							I also recommend that you save before doing this. Messing up can be usually fixed by resetting ; whenever you doubt you're doing it right, start over again.
							<ol>
								<li>
									Set up your item pack as such :
									<table class="table table-striped">
										<tr><th>Item</th><th>Quantity</th></tr>
										<tr><td>Trash item #1</td><td>x[Any]</td></tr>
										<tr><td>Trash item #2</td><td>x[Any]</td></tr>
										<tr><td>Any item #1</td><td>x[Any]</td></tr>
										<tr><td>X Special</td><td>x1</td></tr>
										<tr><td>Any item #2</td><td>x[Any]</td></tr>
										<tr><td>Any item #3</td><td>x1</td></tr>
										<tr><td>CANCEL</td><td></td></tr>
									</table>
								</li>
								<li>Encounter MissingNo to duplicate the item in the sixth inventory slot.</li>
								<li>Toss and/or use 2 of these items.</li>
								<li>Encounter MissingNo again.</li>
								<li>Get a Pok&eacute;mon with either Fly, Dig or Teleport. Be careful with Fly : you also need Misty's Badge.</li>
								<li>Go to this spot east of Celadon City.<img src="http://glitchcity.info/w/images/9/9c/Celadon_looping_map_trick_spot.png" class="img-responsive" /></li>
								<li>Swap the third and sixth item slots ; the pack should look like this :
									<table class="table table-striped">
										<tr><th>Item</th><th>Quantity</th></tr>
										<tr><td>Trash item #1</td><td>x[Any]</td></tr>
										<tr><td>Trash item #2</td><td>x[Any]</td></tr>
										<tr><td>Any item #3</td><td>x255 (appears as [glitch blob]5)</td></tr>
										<tr><td>X Special</td><td>x1</td></tr>
										<tr><td>Any item #2</td><td>x[Any]</td></tr>
										<tr><td>Any item #1</td><td>x[Any]</td></tr>
										<tr><td>CANCEL</td><td></td></tr>
									</table>
								</li>
								<li>Deposit all the fifth and sixth items in the PC. You can also use them or toss them, that doesn't matter.</li>
								<li>Do the same with the first item slot, but three times (trust me, I know what I'm saying). The pack should look like
									<table class="table table-striped">
										<tr><th>Item</th><th>Quantity</th></tr>
										<tr><td>Any item #3</td><td>x255</td></tr>
										<tr><td>Any item #3</td><td>x255</td></tr>
										<tr><td>Any item #3</td><td>x255</td></tr>
										<tr><td>X Special</td><td>x1</td></tr>
										<tr><td>CANCEL</td><td></td></tr>
									</table>
									But you can't scroll past the second item slot, which closes the menu when you press A on. If that's the case, you're on the right track. Otherwise, remember what I said : reset and start over again. You don't wanna mess up your save file.
								</li>
								<li>Now, deposit/use/toss 253 of the first item slot. To do this, select TOSS, then press Down four times, then confirm. You should have only two items in the first slot.</li>
								<li>Press SELECT on the first item slot, then on the second item slot. Repeat, and the pack should be
									<table class="table table-striped">
										<tr><th>Item</th><th>Quantity</th></tr>
										<tr><td>Any item #3</td><td>x0 (yeah, that's a thing)</td></tr>
										<tr><td>X Special</td><td>x1</td></tr>
										<tr><td>CANCEL</td><td></td></tr>
									</table>
									AND you should be able to scroll past the CANCEL, and through a bunch of glitched stuff.
									<br/>
									<strong>Congratulations on performing Dry Item Underflow ! You can save now.</strong>
								</li>
								<li>Press SELECT on the X Special x1, and begin to scroll down.</li>
								<li>At some point, the cursor might freeze and stop responding. If that happens, press B enough times that the problem goes away. Be careful not to mash the button, as closing the menu will require you to press SELECT again on the X Special... and you'll have to start all over again.</li>
								<li>Once you stumble on a Nugget x1, press SELECT on it to swap it with the X Special. To facilitate things later, don't move the cursor.</li>
								<li>Close all menus, and begin walking right. You can also walk up or down when you need it, it's <strong>not an issue at all</strong>. It's horizontal movement that matters.</li>
								<li>You will enter Celadon City again, but from the left. It will also be devoid of any NPCs, warps and text. Open your ITEM menu regularly until you see a "8F" item on your cursor. If the quantity is "x0", walk one more step right to have it become "x1".<br/>The sequence of item that will appear before 8F will be 1F, 2F, 3F, etc. If you have 9F, 10F, 11F, etc., walk left a few steps until you have 8F.</li>
								<li>Once your ITEM cursor is over 8F, we need to get it out of this glitched zone. To do so, press SELECT on it, and begin scrolling up. Use B when the cursor stop responding.</li>
								<li>When you find the Nugget x1 again, press SELECT on it to swap it with 8F. You're almost done ! You now need to use Fly, Dig or Teleport to go to any Pok√©mon Center.</li>
								<li>Go to any PC, and open the item storage system. Deposit 8F, then retrieve any item three times. Note that they will be lost ! You can retrieve, for example, Moon Stone x1 then Moon Stone x1 then Moon Stone x1. Yep, it'll work.</li>
								<li>You can then safely get 8F ! Hooray !</li>
							</ol>
						</p>
						<p>
							Now that you have 8F, you can try to USE it... but if the game doesn't crash, then you might as well drop reading this an go gamble for a bit. 8F isn't magical, so we need some setup to make it work. How do we do this ? By having a specific Pok&eacute;mon party ! Read <a href="http://glitchcity.info/wiki/Arbitrary_code_execution">this article</a> for some good and simple setups.
							<br/>
							Advice : <strong>don't use any 3-Pok&eacute; setup</strong> ! For technical reasons, this setup causes lotsa problems. Please, unless you know what you're doing, <strong>don't use it</strong>.
						</p>
						<p>
							Now, if you use 8F... you will also almost certainly crash. "Again !?" I hear you say. Yep, but you're waaay closer to making 8F do whatever you want. You see, when you have a correct party setup, your bag items, starting from the third, are <strong>read by the CPU and interpreted as code</strong> ! Yes, you're basically writing code using your items. Pretty mind-blowing, huh ?<br/>Well, now it's time to make it useful.
						</p>
					</div>
					<div role="tabpanel" class="tab-pane" id="items">
						<h4>Making 8F useful</h4>
						<p>
							Ahhh... the part where we can play God.
						</p>
					</div>
					<div role="tabpanel" class="tab-pane" id="creating">
						
					</div>
					<div role="tabpanel" class="tab-pane" id="tech">
						<h4>8F's inner workings</h4>
						<p>
							I really recommend that you have some knowledge of <a href="http://gbdev.gg8.se/wiki/articles/Pan_Docs">the Game Boy's circuitry</a> and <a href="http://tutorials.eeems.ca/ASMin28Days">CPU assembly</a>.
							<br/>
							How does 8F make this magic possible ? Why and how the setups ?
							<br/>
							So many questions. And they all have answers !
						</p>
						<p>
							8F is an item with identifier 5D. That's all ! That's all its magic : being an invalid item. Now, let's take a look at the routine called by the game when using an item.
							<br/>
							<br/>
							ROM offset : D5C7
							<br/>
							GB offset : ROM03:55C7
							<br/>
							<pre>
UseItem_:
	ld a,1
	ld [CD6A],a       ; initialise output to success value
	ld a,[CF91]       ; contains the ID of the item being used
	cp a,HM_01        ; HM_01 equals 196
	jp nc,ItemUseTMHM ; TMs and HMs have a special script
	
	ld hl,ItemUsePtrTable
	dec a
	add a
	ld c,a
	ld b,0
	add hl,bc
	ld a,[hli]
	ld h,[hl]
	ld l,a
	jp [hl]</pre>
							ItemUsePtrTable has ROM offset D5E1, and GB offset ROM03:55E1. Let's follow what happens with CF91 containing 5D : what happens when using 8F.
						</p>
						<p>
							The game doesn't jump to ItemUseTMHM, so :
							<pre>
	ld hl,ItemUsePtrTable ; HL = $55E1
	dec a                 ; A = $5C
	add a                 ; A = $B8
	ld c,a                ; C = $B8
	ld b,0                ; BC = $00B8
	add hl,bc             ; HL = $5699</pre>
							At this point, we need to know what is at ROM03:5699. And this is where we were over-lucky. Because <a href="https://github.com/pret/pokered/blob/46a94c63fc287e7290502776d02648476bc44171/engine/items/items.asm#L119">at ROM03:5698</a> is a ld a,[$D163] instruction in the middle of the ItemUseBall routine. Which means that ROM03:5699-569A contains the address $D163.
							<pre>
	ld a,[hli] ; A = $63
	ld h,[hl]  ; HL = $D199
	ld l,a     ; HL = $D163
	jp [hl]    ; PC = $D163</pre>
							The game actually read the operand of the "ld a,[addr]" instruction as an address, and <em>by sheer luck</em> they use the same formats. Alleluia ! ACE.
							<br/>
							And so CPU execution continues at $D163, where everything begins...
						</p>
					</div>
				</div>
				<p>
					<a href="#">Back to dem top</a>
				</p>

			</div>
			
			<hr>

			<footer>
				<p>&copy; 2016 and onwards to infinity, ISSOtm</p>
			</footer>
		</div> <!-- /container -->
		
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
	</body>
</html>
