<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>ISSOtm's website &bull; The Luigi Exploit</title>

		<!-- Bootstrap -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
		
		<link rel="stylesheet" href="../css/common.css">

		<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
		<!--[if lt IE 9]>
			<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
			<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->
	</head>
	<body>
		<nav class="navbar navbar-inverse navbar-fixed-top">
			<div class="container">
				<div class="navbar-header">
					<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
						<span class="sr-only">Toggle navigation</span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</button>
					<a class="navbar-brand" href="https://issotm.github.io/">ISSOtm's website</a>
				</div>
				<div id="navbar" class="navbar-collapse collapse">
					<ul class="nav navbar-nav">
						<li><a href="../aboutme.html">About me</a></li>
						<li><a href="../aevilia.html">Aevilia</a></li>
						<li>8F Helper</li>
						<li><a href="http://prama-initiative.com/8F/beta/">GBZ80 to Items</a></li>
						<li class="active"><a href="../pokexploits/">Pok&eacute;sploitz</a></li>
						<li>The rest</li>
					</ul>
			</div>
		</nav>
		
		
		<div class="container">
			<h2>Weegifying Games</h2>
			<p class="lead">
				ACE is freakin' tough. You make the console do whatever you want with ACE. Except modifying the ROM, tough luck. BUT everything else WORKS !
				<br/>
				Sadly, some games are programmed too well for ACE to be possible...
				<br/>
				Unless you do something the engineers that created the Game Boy probably never thought someone did someday. Let's get started.
			</p>
			
			<hr>
			
			<h3>Click the tabs to see stuff !</h3>
			<div>

				<!-- Nav tabs -->
				<ul class="nav nav-tabs" role="tablist">
					<li role="presentation" class="active"><a href="#WTF" aria-controls="WTF" role="tab" data-toggle="tab">What... is... this ..?</a></li>
					<li role="presentation"><a href="#history" aria-controls="history" role="tab" data-toggle="tab">Credits and history</a></li>
					<li role="presentation"><a href="#further" aria-controls="further" role="tab" data-toggle="tab">What about... ?</a></li>
					<li role="presentation"><a href="#tech" aria-controls="tech" role="tab" data-toggle="tab">Tech details</a></li>
				</ul>

				<!-- Tab panes -->
				<div class="tab-content">
					<div role="tabpanel" class="tab-pane active" id="WTF">
						<h4>What is this ?</h4>
						<p>
							The concept is this :
							<ol>
								<li>Plug Pok&eacute;mon Red, Blue or Yellow in your PGB, SGB or GBC.</li>
								<li>Using an ACE glitch, execute a certain code.</li>
								<li>This code freezes the game. While it is frozen, remove the cartridge, and put another in its place.</li>
								<li>The new game starts up !</li>
							</ol>
							Pretty mind-blowing, right ?
							<br/>
							<br/>
							...
							<br/>
							What do you mean, <em>"You just have reset your console !"</em> ?
							<br/>
							Didn't you understand ? <strong>I did not do that !</strong>
							<br/>
							<strong>I made the CPU execute custom code while another cartridge than Pok&eacute;mon was inserted !</strong>
							<br/>
							In that case, the custom code just started the game. But what if that code edited the save file in a specific way ? Or jumped to the code that displayed the credits ?
							<br/>
							You guessed it. We could already do anything with Pok&eacute;mon. Now we can do anything with <strong>any game</strong>.
						</p>
						<p>
							Interested ? Then here goes the method !
						</p>
					</div>
					<div role="tabpanel" class="tab-pane" id="history">
						<h4>Credits</h4>
						<p>
							Now we can <em>really</em> break games beyond imagination.
						</p>
					</div>
					<div role="tabpanel" class="tab-pane" id="further">
						<h4>Going further with this</h4>
						<p>
							Okay, I've presented a method to do this on Game Boy.
							<br/>
							The method is specific to the GB.
						</p>
						<p>
							But. The general concept ; removing a cartridge while the CPU is NOT accessing it to essentially have ACE on the new cart.
							<br/>
							That's not console-specific.
							<br/>
							The concept is even more general, imagine performing it with an USB key ?
							<br/>
							Or at least with a different console.
							<br/>
							...Okay, people knowing how to access Super Mario Bros. glitch worlds on the Famicom using Tennis will recognize something similar here.
							<br/>
							This has been tested on SNES, and it looks like it... doesn't work ? D'oh !
							<br/>
							Still, I heard nobody tried using these neat "piggybacking" adapters (those used to bypass region restrictions). I believe using those will fix the problem, but I didn't try !
						</p>
					</div>
					<div role="tabpanel" class="tab-pane" id="tech">
						<h4>8F's inner workings</h4>
						<p>
							I really recommend that you have some knowledge of <a href="http://gbdev.gg8.se/wiki/articles/Pan_Docs">the Game Boy's circuitry</a> and <a href="http://tutorials.eeems.ca/ASMin28Days">CPU assembly</a>.
							<br/>
							How does 8F make this magic possible ? Why and how the setups ?
							<br/>
							So many questions. And they all have answers !
						</p>
						<p>
							8F is an item with identifier 5D. That's all ! That's all its magic : being an invalid item. Now, let's take a look at the routine called by the game when using an item.
							<br/>
							<br/>
							ROM offset : D5C7
							<br/>
							GB offset : ROM03:55C7
							<br/>
							<pre>
UseItem_:
	ld a,1
	ld [CD6A],a       ; initialise output to success value
	ld a,[CF91]       ; contains the ID of the item being used
	cp a,HM_01        ; HM_01 equals 196
	jp nc,ItemUseTMHM ; TMs and HMs have a special script
	
	ld hl,ItemUsePtrTable
	dec a
	add a
	ld c,a
	ld b,0
	add hl,bc
	ld a,[hli]
	ld h,[hl]
	ld l,a
	jp [hl]</pre>
							ItemUsePtrTable has ROM offset D5E1, and GB offset ROM03:55E1. Let's follow what happens with CF91 containing 5D : what happens when using 8F.
						</p>
						<p>
							The game doesn't jump to ItemUseTMHM, so :
							<pre>
	ld hl,ItemUsePtrTable ; HL = $55E1
	dec a                 ; A = $5C
	add a                 ; A = $B8
	ld c,a                ; C = $B8
	ld b,0                ; BC = $00B8
	add hl,bc             ; HL = $5699</pre>
							At this point, we need to know what is at ROM03:5699. And this is where we were over-lucky. Because <a href="https://github.com/pret/pokered/blob/46a94c63fc287e7290502776d02648476bc44171/engine/items/items.asm#L119">at ROM03:5698</a> is a ld a,[$D163] instruction in the middle of the ItemUseBall routine. Which means that ROM03:5699-569A contains the address $D163.
							<pre>
	ld a,[hli] ; A = $63
	ld h,[hl]  ; HL = $D199
	ld l,a     ; HL = $D163
	jp [hl]    ; PC = $D163</pre>
							The game actually read the operand of the "ld a,[addr]" instruction as an address, and <em>by sheer luck</em> they use the same formats. Alleluia ! ACE.
							<br/>
							And so CPU execution continues at $D163, where everything begins...
						</p>
					</div>
				</div>
				<p>
					&nbsp;<br/><a href="#">Back to dem top</a>
				</p>

			</div>
			
			<hr>

			<footer>
				<p>&copy; 2016 and onwards to infinity, ISSOtm</p>
			</footer>
		</div> <!-- /container -->
		
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
	</body>
</html>
